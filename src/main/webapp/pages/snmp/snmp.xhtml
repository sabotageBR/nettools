<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:itm="http://java.sun.com/jsf/composite/components"
	template="/WEB-INF/templates/default.xhtml">

	<ui:param name="title" value="SNMP" />
	<ui:param name="keywords" value="SNMP Test online, SNMP Test, SNMP online, SNMP Tools,SNMP Tools online" />
	<ui:define name="corpo">
	<script src="#{request.contextPath}/resources/scripts/reconnecting-websocket.min.js"></script>
	
	<h:form id="idFormSnmp" prependId="false">
		<div id="wrapper">
			<div class="content animate-panel">

				<div class="row">
					<div class="col-md-offset-1 col-lg-7">
						<div class="hpanel">
							<div class="panel-heading">
								<div class="row">
									<h1 class="font-extra-bold no-margins text-success text-center">Snmp</h1>
								</div>				
							</div>
							<div class="panel-body">
								<div class="row">
								
									<div class="form-group col-lg-3">
		                                <label>Host</label>
		                                <br />
			                            <h:inputText id="id-input-host" value="#{snmpController.to.host}" styleClass="form-control" />
		                            </div>
									<div class="form-group col-lg-2">
		                                <label>Porta</label>
		                                <br />
		                                <h:inputText id="id-input-porta" value="#{snmpController.to.porta}" styleClass="form-control" size="5">
		                                	<f:passThroughAttribute name="type" value="tel" />
		                                </h:inputText>
		                            </div>
		                            <div class="form-group col-lg-2">
		                                <label>OID</label>
		                                <br />
		                                <h:inputText id="id-input-oid" value="#{snmpController.to.oid}" styleClass="form-control"/>
		                            </div>
		                            <div class="form-group col-lg-2">
		                                <label>Vers√£o</label>
		                                <br />
		                                <h:inputText id="id-input-versao" value="#{snmpController.to.versao}" styleClass="form-control" size="3"/>
		                            </div>
		                            <div class="form-group col-lg-2">
		                                <label>Community</label>
		                                <br />
		                                <h:inputText id="id-input-community" value="#{snmpController.to.community}" styleClass="form-control" />
		                            </div>
		                            <div class="form-group col-lg-3">
			                            <h:commandButton action="#{snmpController.snmp}" value="Go!" id="id-button-snmp" styleClass="btn btn-success btn-lg" style="margin-top: 10px">
			                            	<f:ajax event="click" onevent="buttonClick()" execute="idFormSnmp" render="idPanelHistory"/>
			                            </h:commandButton>
		                            </div>
			                    </div>    
							</div>
							<div id="id-panel-footer" class="panel-footer" style="background: #000;">
								<code id="id-panel-result" style="background-color: #000;color: #62cb31;min-height: 200px;">Net Tools Live - Terminal...</code>
		                    </div>
						</div>
						<div class="row">
							<br />
							<br />
							<br />
							<div class="panel-footer">
			                    	<div class="fb-comments" data-href="https://nettools.live/snmp" data-width="" data-numposts="10"></div>
			                 </div>
						</div>
						<ui:include src="/pages/blog/blog-include-horizontal.xhtml">
							<ui:param name="tamanhodiv" value="4" />
						</ui:include>
					</div>
					<div class="col-lg-3">
						<div class="hpanel" id="id-panel-api-geral" style="display: none">
							<div class="panel-heading">
								<div class="row">
									<h2 class="font-extra-bold no-margins text-success text-center">API</h2>
								</div>				
							</div>
							<div class="panel-body" style="display: inline-flex;">
								<small id="id-panel-api" style="font-size: 70%;"></small>
							</div>
						</div>
						<h:panelGroup id="idPanelHistory">
						<ui:fragment rendered="#{customIdentity.snmps.size() gt 0}">
							<h4 class="font-extra-bold no-margins text-success text-center">History</h4>
							<br />
							
								<h:dataTable id="idTableSnmps" value="#{customIdentity.snmps}" var="snmp" styleClass="table">
									<h:column>
										<f:facet name="header">
											play
										</f:facet>
										<a onclick="searchHistory('#{snmp.host}','#{snmp.porta}','#{snmp.oid}','#{snmp.versao}','#{snmp.community}')">
											<i class="pe-7s-upload pe-rotate-90"></i>
										</a>
									</h:column>
									<h:column>
										<f:facet name="header">
											host
										</f:facet>
										#{snmp.host}
									</h:column>
									<h:column>
										<f:facet name="header">
											Data
										</f:facet>
										#{snmp.dateTimeFormat}
									</h:column>
									
								</h:dataTable>
								<script>
							    $('#idTableSnmps').DataTable( {
							        "paging":   true,
							        "ordering": false,
							        "searching":     false,
							        "bLengthChange": false,
							        "info":     false,
							        "fnDrawCallback": function(oSettings) {
							            if (oSettings._iDisplayLength > oSettings.fnRecordsDisplay()) {
							                $(oSettings.nTableWrapper).find('.dataTables_paginate').hide();
							            } else {
							                 $(oSettings.nTableWrapper).find('.dataTables_paginate').show();
							            }
							        }
							    } );
								</script>	
						</ui:fragment>
					  </h:panelGroup>
					  <br /><br />
						<div class="hpanel" style="margin-top: 20px">
							<code style="background: none;color: #000">
								<h:outputText value="#{resources['text.global.snmp']}" />
							</code>
						</div>					
					</div>
					
							
				</div>
			</div>

			<footer class="footer">
				<span class="pull-right"> Net Tools Live </span> Company 2021
			</footer>
		</div>	
	</h:form>	
	<script>
	//<![CDATA[
	 document.getElementById('id-panel-footer').style.display = 'none';
	  	
 	  var wsocketHost = null;	
	  function connect() {         
		//wsocketHost = new ReconnectingWebSocket("ws://nettools.local:8080/SnmpServer", null, {debug: true, reconnectInterval: 3000});
		wsocketHost = new ReconnectingWebSocket("wss://nettools.live/SnmpServer", null, {debug: true, reconnectInterval: 3000});
		wsocketHost.onmessage = onMessage;  
		wsocketHost.onopen = onOpen;  
	  }

	  function onMessage(evt) {
		  
		  let obj = JSON.parse(evt.data);
		  if(obj.resultado !== 'FIM'){
			  document.getElementById('id-panel-result').innerHTML += obj.resultado +'<br />';
		  }else{
			  document.getElementById("id-button-snmp").disabled = false;
			  document.getElementById("id-button-snmp").value = "Go!";
		  }
		  
	  }
	  
	  function onOpen(evt) {   
		            
	  }
	  
	  var buttonClick = function(){
		  if (wsocketHost.readyState === WebSocket.CLOSED) {
			   connect();
		  }
		  
		  document.getElementById('id-panel-footer').style.display = 'block';
		  document.getElementById('id-panel-api-geral').style.display = 'block';
		  document.getElementById("id-button-snmp").disabled = true;
		  document.getElementById("id-button-snmp").value = "...";
		  document.getElementById('id-panel-result').innerHTML = '';
		  wsocketHost.send(JSON.stringify({
			    ipExterno:document.getElementById('id-ip-externo').value,
			  	host: document.getElementById('id-input-host').value,
			  	porta: document.getElementById('id-input-porta').value,
			  	oid: document.getElementById('id-input-oid').value,
			  	versao: document.getElementById('id-input-versao').value,
			  	community: document.getElementById('id-input-community').value	
		  }));
		  let hostApi = compositeApi(document.getElementById('id-input-host').value,document.getElementById('id-input-porta').value, document.getElementById('id-input-oid').value,
				  document.getElementById('id-input-versao').value,document.getElementById('id-input-community').value);
		  let link = "<a href='"+hostApi+"' target='blank'>"+hostApi+"</a>";
		  document.getElementById('id-panel-api').innerHTML = link;
	  }

	  var searchHistory = function(host,porta,oid,versao,community){
		  document.getElementById('id-input-host').value = host;
		  document.getElementById('id-input-porta').value = porta;
		  document.getElementById('id-input-oid').value = oid;
		  document.getElementById('id-input-versao').value = versao;
		  document.getElementById('id-input-community').value = community;
		  buttonClick();	
	  }	  

	  var compositeApi = function(host,porta,oid,versao,community){
			let hostApi = "/api/tools/snmp?host="+host+"&porta="+porta+"&oid="+oid+"&versao="+versao+"&community="+community;
			return hostApi;
	  }

	  $('#idFormSnmp').on('keyup keypress', function(e) {
		  var keyCode = e.keyCode || e.which;
		  if (keyCode === 13) { 
			document.getElementById('id-button-snmp').click();
		    return false;
		  }
		}); 

	  function snmp(){
		  
	  }
	  connect();
	//]]>
	</script>	
	</ui:define>
</ui:composition>	 
	
	